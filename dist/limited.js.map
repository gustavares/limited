{"version":3,"file":"limited.js","sources":["../src/Vector.js","../src/GameObject.js","../src/Keyboard.js","../src/State.js","../src/Text.js","../src/Screen.js","../src/main.js","../src/SpriteSheet.js","../src/AnimationState.js"],"sourcesContent":["export default class Vector {\n    constructor({\n        x, y\n    }) {\n        this.x = x;\n        this.y = y;\n    }\n    plus(other) {\n        return new Vector({\n          x: this.x + other.x, \n          y: this.y + other.y\n        });\n      }\n}","import Vector from './Vector.js';\n\nexport default class GameObject {\n    constructor({\n        name,\n        type,\n        position,\n        width,\n        height,\n        color,\n        speed,\n        sprite\n    }) {\n        this.name = name;\n        this.type = type;\n        this.position = position || new Vector({ x: 0, y: 0 })\n        this.width = width;\n        this.height = height;\n        this.color = color;\n        this.speed = speed || new Vector({ x: 0, y: 0});\n        this.sprite = sprite;\n    }\n\n    getCenter() {\n        return new Vector({\n            x: this.position.x + this.width / 2,\n            y: this.position.y + this.height / 2\n        })\n    }\n\n    update(dt) {\n        this.position = new Vector({\n            x: this.position.x + (this.speed.x * dt),\n            y: this.position.y + (this.speed.y * dt)\n        });\n    }\n}","export const keyCodes = {\n    UP: 38,\n    DOWN: 40,\n    RIGHT: 39,\n    LEFT: 37,\n    W: 87,\n    A: 65,\n    S: 83,\n    D: 68,\n    SPACE: 32\n}\n\nexport default class Keyboard {\n    keyState = {};\n\n    constructor() { \n        window.addEventListener(\"keydown\", this.keyDownHandler);\n\n        window.addEventListener(\"keyup\", this.keyUpHandler);\n    }\n\n    keyDownHandler = (event) => {\n        event.preventDefault();\n        this.keyState[event.keyCode || event.which] = true;\n    }\n\n    keyUpHandler = (event) => {\n        event.preventDefault();\n        this.keyState[event.keyCode || event.which] = false;\n    }\n}\n","import GameObject from \"./GameObject.js\";\nimport Keyboard from \"./Keyboard.js\";\n\nexport default class State {\n\n    /**\n     * \n     * @param {{\n     *  gameObjects: GameObject[],\n     *  state: State\n     * }} param0 \n     */\n    constructor({ gameObjects, textObjects, state }) {\n        this.gameObjects = gameObjects;\n        this.textObjects = textObjects;\n        this.state = state;\n        this.keyboard = new Keyboard();\n    }\n\n    setGameObjects(go) {\n        this.gameObjects = go;\n    }\n\n    getGameObject(name) {\n        return this.gameObjects.find((go) => go.name === name);\n    }\n\n    getGameObjectsByType(type) {\n        return this.gameObjects.map((go) => go.type === type);\n    }\n\n    /**\n     * @returns {GameObject[]} gameObjects\n     */\n    getGameObjects() {\n        return this.gameObjects;\n    }\n\n    getTextObject(label) {\n        return this.textObjects.find((to) => to.label === label);\n    }\n\n    deleteTextObject(label) {\n        const index = this.textObjects.findIndex((to) => to.label === label);\n        \n        if (index !== -1) {\n            this.textObjects.splice(index, 1);\n        }\n    }\n\n    /**\n     * @param {number} dt \n     * @returns {State}\n     */\n    update(dt) {\n        this.gameObjects.forEach(go => go.update(dt));\n    }\n}","import Vector from \"./Vector.js\";\n\nexport default class Text {\n    /**\n     * \n     * @param {{\n     *  content: string\n     *  position: Vector\n     *  font: string\n     * label: string\n     * }} param0 \n     */\n    constructor({ content, label, position, font = '18px verdana' }) {\n        Object.assign(this, { content, label, position, font });\n    }\n\n    /**\n     * \n     * @param {CanvasRenderingContext2D} context \n     */\n    write(context) {\n        context.font = this.font;\n        context.fillText(this.content, this.position.x, this.position.y);\n    }\n\n    update(newContent) {\n        this.content = newContent;\n\n        return this;\n    }\n}","import GameObject from './GameObject.js';\nimport Text from './Text.js';\n\nexport default class GameScreen {\n    constructor({ canvasId, width, height }) {\n        this.canvas = document.getElementById(canvasId);\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.context = this.canvas.getContext('2d');\n        \n    }\n\n    clear() {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    /**\n     * \n     * @param {GameObject[]} currentGameObjects \n     * @param {GameObject[]} previousGameObjects \n     * @param {number} interpolation\n     */\n    renderObjects(currentGameObjects, previousGameObjects, interpolation) {\n\n        for (const object of currentGameObjects) {\n            const { name, width, height, color, sprite, currentAnimationStateName, position } = object;\n            let { x, y } = position;\n\n            if (name === undefined) throw Error('name not found');\n            if (x === undefined) throw Error('x not found');\n            if (y === undefined) throw Error('y not found');\n            if (width === undefined) throw Error('width not found');\n            if (height === undefined) throw Error('height not found');\n            if (color === undefined) throw Error('color not found');\n\n            if (previousGameObjects.length) {\n                const previousGo = previousGameObjects.find((go) => go.name === name);\n                if (previousGo) {\n                    const prevX = previousGo.position.x;\n                    const prevY = previousGo.position.y;\n\n                    x = x * interpolation + prevX * (1 - interpolation);\n                    y = y * interpolation + prevY * (1 - interpolation);\n                }\n            }\n\n        \n            if (sprite !== undefined) {\n               const spritePosition = sprite.getCurrentSpritePosition();\n               this.context.drawImage(sprite, spritePosition.x * width, spritePosition.y * height, sprite.width, sprite.height, x, y, width, height);\n            } else {\n                this.context.fillStyle = color;\n                this.context.fillRect(x, y, width, height);\n            }\n        }\n    }\n\n    /**\n     * \n     * @param {Text[]} texts \n     */\n    write(texts) {\n        for (const text of texts) {\n            text.write(this.context);\n        }\n    }\n}","import GameScreen from \"./Screen.js\";\nimport State from \"./State.js\";\nimport Text from './Text.js';\n\nconst\n    ONE_SECOND = 1000,\n    UPDATES_PER_SECOND = 60;\n\nconst settings = {\n    currentFps: 1,\n    framesThisSecond : 0,\n    lastFpsUpdate: 0,\n    decayRatio: 0.25,\n    MS_PER_UPDATE: Number((ONE_SECOND / UPDATES_PER_SECOND).toFixed(1))\n};\nexport let framesRendered = 0;\n\n/**\n * \n * @param {{\n *  firstState: State\n *  screen: GameScreen\n *  update: Function\n * }} param0 \n */\nexport function start({ firstState, screen, update }) {\n    const timeStep = settings.MS_PER_UPDATE;\n    \n    let lag = 0.0, \n        previousTime = window.performance.now();\n    let currentState = firstState; \n    let previousState;\n    \n    const gameLoop = (currentTime) => {\n        const elapsedTime = currentTime - previousTime;\n        previousTime = currentTime;\n        lag += elapsedTime;\n        \n        if (currentTime > settings.lastFpsUpdate + ONE_SECOND) {\n            /**\n             * Weighted moving average to calculate FPS\n             * https://gamedev.stackexchange.com/questions/141325/finding-average-input-value-over-time-in-seconds\n             * \n             * https://stackoverflow.com/questions/4687430/c-calculating-moving-fps\n             */\n            settings.currentFps = settings.decayRatio * settings.framesThisSecond + (1 - settings.decayRatio) * settings.currentFps;\n\n            settings.lastFpsUpdate = currentTime;\n            settings.framesThisSecond = 0;\n        }\n        settings.framesThisSecond++;\n\n        while (lag >= timeStep) {\n\n            previousState = currentState;\n            update({ state: currentState, dt: timeStep});\n            currentState.update(timeStep);\n            lag -= timeStep;\n        }\n\n        framesRendered++;\n        render(\n            screen,\n            { \n                currentState,\n                previousState,\n                texts: [\n                    new Text({ \n                        content: `FPS: ${Math.round(settings.currentFps)}`,\n                        position: { x: 1400, y: 30 },\n                        label: 'FPS'\n                    }),\n                    ...currentState.textObjects\n                ],\n                interpolation:  lag / settings.MS_PER_UPDATE\n            }\n        );\n\n        window.requestAnimationFrame(gameLoop);\n    };\n\n    gameLoop(window.performance.now());\n}\n\n/**\n * @param {{\n *  currentState: State\n *  previousState: State\n *  texts: Text[]\n *  interpolation: number\n * }} params\n */\nfunction render(screen, { currentState, previousState, interpolation, texts }) {\n    screen.clear();\n    screen.write(texts);\n\n    const previousGameObjects = previousState ? previousState.getGameObjects() : [];\n    screen.renderObjects(currentState.getGameObjects(), previousGameObjects, interpolation);\n}","import { framesRendered } from './main.js';\nconst STAGGER_FRAMES = 6;\n\nexport default class SpriteSheet extends Image {\n    constructor({\n        spriteSheetWidth,\n        spriteSheetHeight,\n        numberOfSprites,\n        maxSpritesPerRow,\n        numberOfRows,\n        currentAnimationStateName,\n        animationStates,\n        src\n    }) {\n        super(spriteSheetWidth/maxSpritesPerRow, spriteSheetHeight/numberOfRows);\n        this.maxSpritesPerRow = maxSpritesPerRow;\n        this.numberOfSprites = numberOfSprites;\n        this.numberOfRows = numberOfRows;\n        this.spriteSheetWidth = spriteSheetWidth;\n        this.spriteSheetHeight = spriteSheetHeight;\n        this.currentAnimationStateName = currentAnimationStateName;\n        this.animationStates = animationStates;\n        this.src = src;\n    }\n\n    getCurrentSpritePosition() {\n        const currentStateIndex = this.animationStates.findIndex((state) => state.name === this.currentAnimationStateName);\n        const currentState = this.animationStates[currentStateIndex];\n        \n        // todo: if the animation just started should render from the first sprite in the animation sequence\n        const currentAnimationFrame = Math.floor(framesRendered/STAGGER_FRAMES) % currentState.numberOfFrames;\n\n        return {\n            x: currentAnimationFrame,\n            y: currentStateIndex\n        }\n    }\n}","export default class AnimationState {\n    constructor({\n        name, \n        numberOfFrames\n    }) {\n        this.name = name;\n        this.numberOfFrames = numberOfFrames;\n    }\n}"],"names":["Vector","y","this","x","plus","other","GameObject","type","position","width","height","color","speed","sprite","name","getCenter","update","dt","keyCodes","UP","DOWN","RIGHT","LEFT","W","A","S","D","SPACE","Keyboard","keyState","keyDownHandler","event","preventDefault","_this","keyCode","which","keyUpHandler","window","addEventListener","State","textObjects","state","gameObjects","keyboard","setGameObjects","go","getGameObject","find","getGameObjectsByType","map","getGameObjects","getTextObject","label","to","deleteTextObject","index","findIndex","splice","forEach","Text","font","Object","assign","content","write","context","fillText","newContent","GameScreen","canvas","document","getElementById","canvasId","getContext","clear","clearRect","renderObjects","currentGameObjects","previousGameObjects","interpolation","object","undefined","Error","length","previousGo","spritePosition","getCurrentSpritePosition","drawImage","fillStyle","fillRect","texts","settings","currentFps","framesThisSecond","lastFpsUpdate","decayRatio","MS_PER_UPDATE","Number","toFixed","framesRendered","start","previousState","firstState","screen","timeStep","lag","previousTime","performance","now","currentState","gameLoop","currentTime","elapsedTime","render","Math","round","requestAnimationFrame","SpriteSheet","spriteSheetWidth","spriteSheetHeight","numberOfSprites","maxSpritesPerRow","numberOfRows","currentAnimationStateName","animationStates","src","currentStateIndex","_this2","floor","numberOfFrames","Image","AnimationState"],"mappings":"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"}